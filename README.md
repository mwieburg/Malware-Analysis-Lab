# Malware-Analysis-Lab

This project was completed to establish a isolated environment for analyzing malware from various sources used during the exploitation phase of the cyber kill chain. The lab consists of 2 virtual machines running on isolated virtual interfaces using Proxmox. The segmentation of the malware analysis VMs is managed by a pfSense firewall to secure the communication between the labs and other machines when malware is detonated. 

## Flare-VM: Windows Malware Analysis VM
The Windows VM for malware analysis was created using Proxmox virtualization software. To setup the Flare-VM environment in my Proxmox Windows 10 VM, the main github page was followed to install the tools for malware analysis and reverse engineering (https://github.com/mandiant/flare-vm)

For best practices, recommendations from Proxmox were followed to optimize the performance of the Win10 VM (https://pve.proxmox.com/wiki/Windows_10_guest_best_practices)

Windows 10 VM Virtual specs on Proxmox server:

![image](https://github.com/user-attachments/assets/a419fff0-a351-471e-97c9-3cbf88592eb7)

Clean snapshot of the VM to revert to after malware detonation:

![image](https://github.com/user-attachments/assets/5240340b-7295-489f-ad0a-98a424ed8484)

Flare-VM setup with available tools for malware analysis:

![image](https://github.com/user-attachments/assets/87829ad3-95fa-4316-b5d7-53b3daa87e39)

![image](https://github.com/user-attachments/assets/90957f8a-3fc1-471f-8d7b-b5b02dc982ad)

![image](https://github.com/user-attachments/assets/42bf5a5f-a0cb-4eb2-ae68-56cd3325d66b)

![image](https://github.com/user-attachments/assets/12990836-19a5-4556-ab46-07cca74e38fa)





## REMnux: Linux Malware Analysis VM

REMnux is a Linux tool for malware analysis and can be used for reverse engineering and studying malware designed to exploit Linux OS environments. To install the OVA Image as a new VM in my Proxmox server, I followed the steps provided on the Remnux.org setup page (https://docs.remnux.org/install-distro/get-virtual-appliance).

REMnux VM specs on Proxmox Server with clean state snapshot for reverting after malware analysis:

![image](https://github.com/user-attachments/assets/3d0942a3-0891-4d7e-8702-9db2a1d6ff5c)

![image](https://github.com/user-attachments/assets/17473833-15a3-46ca-a469-50470e7fa124)

REMnux image running on Proxmox server with malware analysis tools:

![image](https://github.com/user-attachments/assets/eeb17507-d2ff-4c4f-a893-f82998f5793c)

![image](https://github.com/user-attachments/assets/70ce00a7-bf6c-4d3b-95e1-1d4eb848c3d4)

## pfSense

Communication into and out of the malware analysis VMs is managed by pfSense to restrict the communication of the VMs to devices within its virtual interface IP range. This will protect other VMs from communicating with the malware analysis VM labs once malware is detonated and analysis begins. 

pfSense VM setup on Proxmox Server. Malware analysis labs are segmented to a separate network via virtual linux bridge VMBR1:

![image](https://github.com/user-attachments/assets/64c3487e-ddf8-4db9-b7e0-0b106883fc36)

<img width="975" alt="pfSense_dashboard" src="https://github.com/user-attachments/assets/2f7dcf0b-06d4-4886-9dfb-c844f31fbcb3">

![image](https://github.com/user-attachments/assets/68cdc4ce-5e43-4ec9-873c-84b2fb496685)

Firewall rules to restrict malware analysis labs from communicating with machines outside of its subnet

![image](https://github.com/user-attachments/assets/c559f143-c11b-4f21-9c6f-a30cd9f3cc01)










